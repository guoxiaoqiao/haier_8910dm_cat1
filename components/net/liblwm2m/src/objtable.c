#include "liblwm2m.h"
#include "lwm2mclient.h"
#include "internals.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <ctype.h>

lwm2m_object_t *get_skel_object(lwm2m_context_t *contextP, uint16_t objid, uint16_t instid, bool *isNewObj);

typedef lwm2m_object_t *(*obj_get_fuc)(void *lwm2mH);

typedef struct
{
    uint16_t objid;
    obj_get_fuc func;
} object_table_t;

object_table_t internal_obj_table[] = {
    {LWM2M_ACL_OBJECT_ID, acc_ctrl_create_object},
    {LWM2M_DEVICE_OBJECT_ID, get_object_device},
    {LWM2M_CONN_MONITOR_OBJECT_ID, get_object_conn_m},
    {LWM2M_FIRMWARE_UPDATE_OBJECT_ID, get_object_firmware},
    {LWM2M_LOCATION_OBJECT_ID, get_object_location},
    {LWM2M_CONN_STATS_OBJECT_ID, get_object_conn_s},
    //{TEST_OBJECT_ID ,get_test_object},
    //{LWM2M_TEMPERATURE_OBJECT_ID,get_temperature_object},
    //{LWM2M_ILLUMINANCE_OBJECT_ID,get_illuminance_object},
};

#define IPSO_STDOBJ_SIZE 1 //175
ipso_obj_t ipso_stdobj_table[] = {
#if 0
    { 10241,1,4,1,0, {{5905,1,1},{5906,1,1},{5907,1,1},{5908,1,1}}},
    { 10242,1,51,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,1,1},{4,1,4},{5,1,4},{6,1,4},{7,1,4},{8,1,4},{9,1,4},{10,1,4},{11,1,4},{12,1,4},{13,1,4},{14,1,4},{15,1,4},{16,1,4},{17,1,4},{18,1,4},{19,1,4},{20,1,4},{21,1,4},{22,1,4},{23,1,4},{24,1,4},{25,1,4},{26,1,4},{27,1,4},{28,1,4},{29,1,4},{30,1,4},{31,1,4},{32,1,4},{33,1,4},{34,1,4},{35,1,4},{36,1,4},{37,1,4},{38,1,4},{39,1,4},{40,1,4},{41,1,4},{42,1,4},{43,1,4},{44,1,4},{45,1,4},{46,1,4},{47,1,4},{48,1,4},{49,1,4},{50,1,4}}},
    { 10243,1,18,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,1,1},{4,1,1},{5,1,4},{6,1,4},{7,1,4},{8,1,4},{9,1,4},{10,1,4},{11,1,4},{12,1,4},{13,1,4},{14,1,4},{15,1,4},{16,1,4},{17,1,4}}},
    { 10244,0,32,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,4},{5,1,4},{6,1,4},{7,1,3},{8,1,5},{9,1,3},{10,1,4},{11,1,4},{12,1,3},{13,1,4},{14,1,4},{15,1,3},{16,1,3},{17,1,3},{18,1,3},{19,1,3},{20,1,3},{21,1,3},{22,1,5},{24,1,3},{25,1,3},{26,1,3},{27,1,3},{28,1,5},{29,1,5},{30,1,5},{31,1,5},{32,1,5}}},
    { 10245,0,17,1,0, {{0,1,5},{1,1,5},{2,1,3},{3,0,3},{4,0,3},{5,0,3},{6,0,3},{7,0,3},{8,1,3},{9,0,5},{10,3,0},{11,0,3},{12,0,3},{13,0,3},{14,0,3},{15,0,3},{16,0,3}}},
    { 10246,0,6,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,3},{5,1,6}}},
    { 10247,1,5,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,3}}},
    { 10248,0,3,1,0, {{0,1,3},{1,1,3},{2,1,6}}},
    { 10249,1,9,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,3},{5,1,3},{6,1,3},{7,1,3},{8,1,6}}},
    { 10250,0,2,1,0, {{0,1,2},{1,0,2}}},
    { 10251,1,5,1,0, {{0,0,1},{1,1,1},{2,1,1},{3,0,3},{4,3,0}}},
    { 10252,0,9,1,0, {{1,0,2},{2,1,3},{3,1,3},{4,1,2},{5,1,2},{6,1,3},{7,1,3},{8,0,1},{9,3,1}}},
    { 10253,0,2,1,0, {{0,0,2},{1,1,2}}},
    { 10254,1,9,1,0, {{0,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5701,1,1},{5750,0,1},{5821,0,4}}},
    { 10255,0,6,1,0, {{0,1,3},{1,1,2},{2,1,2},{3,1,1},{4,1,1},{5,1,1}}},
    { 10256,1,6,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,3},{5,1,3}}},
    { 10257,1,18,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,1,1},{11,1,3},{5800,1,4},{5802,1,4},{5805,1,4},{12,1,4},{13,1,4},{14,1,4},{15,1,4},{16,1,4},{17,1,4},{18,1,4},{20,1,4},{21,1,4},{5506,0,255}}},
    { 10258,1,6,1,0, {{0,0,4},{5603,1,4},{5604,1,4},{5701,1,1},{5750,0,1},{5821,0,4}}},
    { 10259,1,5,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,0,5},{4,0,3}}},
    { 10260,1,4,1,0, {{0,0,1},{1,0,1},{2,0,5},{3,3,1}}},
    { 10262,1,4,1,0, {{0,0,1},{1,0,6},{2,1,2},{3,0,6}}},
    { 10263,1,4,1,0, {{0,0,1},{1,0,6},{2,1,2},{3,0,6}}},
    { 10264,1,6,1,0, {{0,0,3},{1,0,1},{2,0,3},{3,0,3},{4,0,3},{5,0,3}}},
    { 10265,0,7,1,0, {{0,0,3},{1,0,1},{2,0,3},{3,0,3},{4,0,3},{5,1,3},{7,1,1}}},
    { 10266,1,15,1,0, {{6000,1,3},{6001,1,3},{6002,1,1},{6003,1,255},{6004,1,255},{6005,0,255},{6006,1,255},{6007,0,5},{6008,3,0},{6009,1,2},{6010,3,0},{6026,3,0},{6027,3,0},{6028,1,3},{6029,1,2}}},
    { 10267,1,15,1,0, {{6000,1,3},{6001,1,3},{6002,1,1},{6003,1,255},{6004,1,255},{6005,0,255},{6006,1,255},{6007,0,5},{6008,3,0},{6009,1,2},{6010,3,0},{6026,3,0},{6027,3,0},{6028,1,3},{6029,1,2}}},
    { 10268,1,15,1,0, {{6000,1,3},{6001,1,3},{6002,1,1},{6003,1,255},{6004,1,255},{6005,0,255},{6006,1,255},{6007,0,5},{6008,3,0},{6009,1,2},{6010,3,0},{6026,3,0},{6027,3,0},{6028,1,3},{6029,1,2}}},
    { 10269,1,15,1,0, {{6000,1,3},{6001,1,3},{6002,1,1},{6003,1,255},{6004,1,255},{6005,0,255},{6006,1,255},{6007,0,5},{6008,3,0},{6009,1,2},{6010,3,0},{6026,3,0},{6027,3,0},{6028,1,3},{6029,1,2}}},
    { 10270,1,15,1,0, {{6000,1,3},{6001,1,3},{6002,1,1},{6003,1,255},{6004,1,255},{6005,0,255},{6006,1,255},{6007,0,5},{6008,3,0},{6009,1,2},{6010,3,0},{6026,3,0},{6027,3,0},{6028,1,3},{6029,1,2}}},
    { 10271,1,15,1,0, {{6000,1,3},{6001,1,3},{6002,1,1},{6003,1,255},{6004,1,255},{6005,0,255},{6006,1,255},{6007,0,5},{6008,3,0},{6009,1,2},{6010,3,0},{6026,3,0},{6027,3,0},{6028,1,3},{6029,1,2}}},
    { 10272,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10273,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10274,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10275,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10276,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10277,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10278,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10279,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10280,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10281,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10282,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10283,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10284,1,15,1,0, {{6011,0,3},{6012,0,5},{6013,1,5},{6014,0,4},{6015,0,3},{6016,0,4},{6017,0,3},{6018,0,3},{6019,0,3},{6020,0,255},{6021,1,255},{6022,3,0},{6023,0,5},{6024,1,3},{6025,1,2}}},
    { 10286,0,2,1,0, {{0,1,2},{1,0,2}}},
    { 10299,0,7,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,1,1},{4,1,1},{5,1,1},{6,1,1}}},
    { 2048,1,5,1,0, {{0,0,1},{1,0,6},{2,0,6},{3,0,6},{4,0,6}}},
    { 2049,0,1,1,0, {{0,0,6}}},
    { 2050,1,2,1,0, {{0,0,6},{1,0,6}}},
    { 2051,1,6,1,0, {{0,0,3},{1,0,1},{2,0,1},{3,0,1},{4,0,5},{5,0,1}}},
    { 2052,1,6,1,0, {{0,0,3},{1,0,3},{2,0,3},{3,0,3},{4,0,3},{5,0,3}}},
    { 2053,1,11,1,0, {{0,0,3},{1,0,1},{2,0,1},{3,0,5},{4,0,1},{5,0,3},{6,0,3},{7,0,3},{8,0,3},{9,0,3},{10,0,1}}},
    { 2054,1,2,1,0, {{0,0,3},{1,0,6}}},
    { 2055,1,6,1,0, {{0,0,1},{1,0,3},{2,0,3},{3,0,6},{4,0,1},{5,0,1}}},
    { 2056,1,3,1,0, {{0,0,3},{1,0,3},{2,0,3}}},
    { 2057,1,5,1,0, {{0,0,3},{1,0,3},{2,0,3},{3,0,3},{4,0,3}}},
    { 3200,1,8,1,0, {{5500,1,5},{5501,1,3},{5502,0,5},{5503,0,3},{5504,0,3},{5505,3,2},{5750,0,1},{5751,1,1}}},
    { 3201,1,3,1,0, {{5550,0,5},{5551,0,5},{5750,0,1}}},
    { 3202,1,8,1,0, {{5600,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5750,0,1},{5751,1,1},{5605,3,2}}},
    { 3203,1,4,1,0, {{5650,0,4},{5750,1,1},{5603,1,4},{5604,1,4}}},
    { 3300,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5750,0,1},{5751,1,1},{5605,3,2}}},
    { 3301,1,7,1,0, {{5700,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5701,1,1}}},
    { 3302,1,6,1,0, {{5500,1,5},{5501,1,3},{5505,3,2},{5751,1,1},{5903,0,3},{5904,0,3}}},
    { 3303,1,7,1,0, {{5700,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5701,1,1},{5605,3,1}}},
    { 3304,1,7,1,0, {{5700,1,4},{5601,1,4},{5602,1,4},{5603,1,1},{5604,1,4},{5701,1,1},{5605,3,2}}},
    { 3305,1,18,1,0, {{5800,1,4},{5801,1,4},{5802,1,4},{5803,1,4},{5804,1,4},{5805,1,4},{5806,0,4},{5810,1,4},{5811,1,4},{5812,1,4},{5813,1,4},{5814,1,4},{5815,1,4},{5816,0,4},{5820,1,4},{5821,0,4},{5822,3,2},{5605,3,2}}},
    { 3306,1,5,1,0, {{5850,0,5},{5851,0,3},{5852,0,3},{5853,0,1},{5750,0,1}}},
    { 3308,1,4,1,0, {{5900,0,4},{5701,1,1},{5706,0,1},{5750,0,1}}},
    { 3310,1,6,1,0, {{5823,0,1},{5824,0,1},{5825,0,1},{5826,0,1},{5827,0,1},{5828,0,1}}},
    { 3311,1,7,1,0, {{5850,0,5},{5851,0,3},{5852,0,3},{5805,1,4},{5820,1,4},{5706,0,1},{5701,1,1}}},
    { 3312,1,5,1,0, {{5850,0,5},{5851,0,3},{5852,0,3},{5805,1,4},{5820,1,4}}},
    { 3313,1,6,1,0, {{5702,1,4},{5703,1,4},{5704,1,4},{5701,1,1},{5603,1,4},{5604,1,4}}},
    { 3314,1,5,1,0, {{5702,1,4},{5703,1,4},{5704,1,4},{5705,1,4},{5701,1,1}}},
    { 3315,1,7,1,0, {{5700,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5701,1,1},{5605,3,2}}},
    { 3316,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3317,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3318,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3319,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3320,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3321,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3322,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3323,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3324,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3325,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3326,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3327,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3328,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3329,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3330,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3331,1,4,1,0, {{5805,1,4},{5701,1,1},{5822,3,0},{5750,0,1}}},
    { 3332,1,5,1,0, {{5705,1,4},{5601,1,4},{5602,1,4},{5605,3,0},{5750,0,1}}},
    { 3333,1,3,1,0, {{5506,0,255},{5507,0,4},{5750,0,1}}},
    { 3334,1,14,1,0, {{5702,1,4},{5703,1,4},{5704,1,4},{5701,1,1},{5508,1,4},{5509,1,4},{5510,1,4},{5511,1,4},{5512,1,4},{5513,1,4},{5605,3,0},{5603,1,4},{5604,1,4},{5750,0,1}}},
    { 3335,1,3,1,0, {{5706,0,1},{5701,1,1},{5750,0,1}}},
    { 3336,1,7,1,0, {{5514,1,1},{5515,1,1},{5516,1,1},{5705,1,4},{5517,1,2},{5518,1,255},{5750,0,1}}},
    { 3337,1,9,1,0, {{5536,0,4},{5537,0,4},{5538,1,4},{5601,1,4},{5602,1,4},{5605,3,0},{5519,1,4},{5520,1,4},{5750,0,1}}},
    { 3338,1,5,1,0, {{5850,0,5},{5851,0,3},{5521,0,4},{5525,0,4},{5750,0,1}}},
    { 3339,1,5,1,0, {{5522,0,2},{5523,3,2},{5851,0,3},{5524,0,4},{5750,0,1}}},
    { 3340,1,11,1,0, {{5521,0,4},{5538,0,4},{5525,0,4},{5523,3,2},{5850,0,5},{5501,1,3},{5544,0,4},{5543,1,5},{5534,0,3},{5526,0,3},{5750,0,1}}},
    { 3341,1,9,1,0, {{5527,0,1},{5528,0,3},{5529,0,3},{5545,1,3},{5546,1,3},{5530,3,0},{5851,0,4},{5531,0,4},{5750,0,1}}},
    { 3342,1,5,1,0, {{5500,1,5},{5501,1,3},{5852,0,3},{5854,0,3},{5750,0,1}}},
    { 3343,1,4,1,0, {{5851,0,4},{5852,0,3},{5854,0,3},{5750,0,1}}},
    { 3344,1,5,1,0, {{5532,1,5},{5533,1,5},{5541,0,3},{5542,0,3},{5750,0,1}}},
    { 3345,1,6,1,0, {{5500,1,5},{5501,1,3},{5702,1,4},{5703,1,4},{5704,1,4},{5750,0,1}}},
    { 3346,1,9,1,0, {{5700,1,4},{5701,1,4},{5601,1,4},{5602,1,4},{5603,1,4},{5604,1,4},{5605,3,2},{5821,0,1},{5750,0,1}}},
    { 3347,1,3,1,0, {{5500,1,5},{5501,1,3},{5750,0,1}}},
    { 3348,1,2,1,0, {{5547,1,3},{5750,0,1}}},
    { 3349,1,4,1,0, {{5910,1,3},{5911,3,2},{5912,0,1},{5750,0,1}}},
    { 3350,1,4,1,0, {{5544,0,4},{5850,0,5},{5501,1,3},{5750,0,1}}},
    { 3351,0,5,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,1,1},{4,1,1}}},
    { 3352,1,4,1,0, {{0,1,3},{6030,1,3},{6031,1,3},{6032,1,3}}},
    { 3353,0,4,1,0, {{6030,1,3},{6031,1,3},{2,1,3},{6033,1,3}}},
    { 3354,0,4,1,0, {{0,1,3},{6032,1,3},{6033,1,3},{3,1,3}}},
    { 3355,0,7,1,0, {{0,1,3},{6032,1,3},{6033,1,3},{3,1,3},{4,1,3},{5,1,3},{6,1,3}}},
    { 3356,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3357,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3358,0,1,1,0, {{0,1,3}}},
    { 3359,0,2,1,0, {{6032,1,3},{6033,1,3}}},
    { 3360,0,4,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3}}},
    { 3361,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3362,0,1,1,0, {{0,1,3}}},
    { 3363,0,1,1,0, {{0,1,3}}},
    { 3364,0,1,1,0, {{0,1,3}}},
    { 3365,0,4,1,0, {{6037,1,3},{6038,1,3},{2,1,3},{3,1,3}}},
    { 3366,0,9,1,0, {{0,1,3},{1,1,3},{2,1,5},{3,1,3},{4,1,3},{5,1,3},{6,1,3},{7,1,5},{8,1,3}}},
    { 3367,0,5,1,0, {{0,1,3},{1,1,3},{2,1,5},{3,1,3},{4,1,5}}},
    { 3368,0,1,1,0, {{0,1,3}}},
    { 3369,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3370,0,6,1,0, {{6037,1,3},{6038,1,3},{6034,1,3},{6035,1,3},{6036,1,3},{6032,1,3}}},
    { 3371,1,6,1,0, {{6037,1,3},{6038,1,3},{6034,1,3},{6035,1,3},{6036,1,3},{6032,1,3}}},
    { 3372,0,3,1,0, {{6037,1,3},{6038,1,3},{2,1,3}}},
    { 3373,0,3,1,0, {{6037,1,3},{6038,1,3},{2,1,3}}},
    { 3374,0,5,1,0, {{6037,1,3},{6038,1,3},{2,1,3},{3,1,3},{4,1,5}}},
    { 3375,0,7,1,0, {{6032,1,3},{6034,1,3},{2,1,3},{3,1,3},{4,1,3},{5,1,3},{6,1,3}}},
    { 3376,0,1,1,0, {{0,1,3}}},
    { 3377,0,9,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,5},{4,1,5},{5,1,3},{6,1,3},{7,1,3},{8,1,3}}},
    { 3378,0,3,1,0, {{0,1,3},{1,1,5},{6037,1,3}}},
    { 3379,0,4,1,0, {{6037,1,3},{6038,1,3},{2,0,3},{3,1,3}}},
    { 3380,0,13,1,0, {{6037,1,3},{6038,1,5},{2,1,3},{3,1,3},{4,1,3},{5,1,3},{6,1,3},{7,1,3},{8,1,5},{9,1,3},{10,1,3},{11,1,3},{12,1,3}}},
    { 3381,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3382,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3383,0,1,1,0, {{0,1,3}}},
    { 3384,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3385,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 3386,0,2,1,0, {{0,1,3},{1,1,3}}},
    { 17,0,8,1,0, {{0,1,3},{1,1,3},{2,0,3},{3,0,3},{4,0,3},{5,0,3},{6,0,3},{7,0,3}}},
    { 0,1,13,1,0, {{0,0,1},{1,0,5},{2,0,3},{3,0,2},{4,0,2},{5,0,2},{6,0,3},{7,0,2},{8,0,2},{9,0,1},{10,0,3},{11,0,3},{12,0,3}}},
    { 2,1,4,1,0, {{0,1,3},{1,1,3},{2,0,3},{3,0,3}}},
    { 11,1,26,1,0, {{0,0,1},{1,0,1},{2,0,5},{3,0,5},{4,0,3},{5,0,1},{6,0,1},{7,0,1},{8,0,1},{9,1,255},{10,1,3},{11,1,3},{12,1,255},{13,1,3},{14,1,3},{15,0,1},{16,0,1},{17,0,1},{18,0,1},{19,0,1},{20,0,1},{21,1,3},{22,1,6},{23,1,3},{24,0,3},{25,1,3}}},
    { 13,0,13,1,0, {{0,0,3},{1,0,3},{2,0,3},{3,0,3},{4,0,3},{5,0,1},{6,0,1},{7,0,5},{8,1,1},{9,1,6},{10,0,3},{11,0,3},{12,0,5}}},
    { 10,0,12,1,0, {{11,1,1},{0,0,1},{1,0,3},{2,0,1},{3,1,6},{4,0,3},{5,0,3},{6,1,3},{7,0,2},{8,0,2},{9,0,2},{10,0,2}}},
    { 4,0,11,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,1},{5,1,1},{6,1,3},{7,1,1},{8,1,3},{9,1,3},{10,1,3}}},
    { 7,0,9,1,0, {{0,1,3},{1,1,3},{2,1,3},{3,1,3},{4,1,3},{5,1,3},{6,3,0},{7,3,0},{8,0,3}}},
    { 15,1,8,1,0, {{0,1,1},{1,1,3},{2,1,1},{3,1,5},{4,1,5},{5,3,0},{6,3,0},{7,0,5}}},
    { 3,0,23,1,0, {{0,1,1},{1,1,1},{2,1,1},{3,1,1},{4,3,0},{5,3,0},{6,1,3},{7,1,3},{8,1,3},{9,1,3},{10,1,3},{11,1,3},{12,3,0},{13,0,255},{14,0,1},{15,0,1},{16,1,1},{17,1,1},{18,1,1},{19,1,1},{20,1,3},{21,1,3},{22,1,6}}},
    { 5,0,9,1,0, {{0,0,2},{1,0,1},{2,3,0},{3,1,3},{5,1,3},{6,1,1},{7,1,1},{8,1,3},{9,1,3}}},
    { 6,0,7,1,0, {{0,1,4},{1,1,4},{2,1,4},{3,1,4},{4,1,2},{5,1,255},{6,1,4}}},
    { 8,0,6,1,0, {{0,0,3},{1,0,1},{2,1,1},{3,3,0},{4,0,1},{5,1,3}}},
    { 16,1,4,1,0, {{0,0,1},{1,3,0},{2,1,2},{3,1,3}}},
    { 0,1,13,1,0, {{0,0,1},{1,0,5},{2,0,3},{3,0,2},{4,0,2},{5,0,2},{6,0,3},{7,0,2},{8,0,2},{9,0,1},{10,0,3},{11,0,3},{12,0,3}}},
    { 1,1,9,1,0, {{0,1,3},{1,0,3},{2,0,3},{3,0,3},{4,3,0},{5,0,3},{6,0,5},{7,0,1},{8,3,0}}},
    { 14,1,6,1,0, {{0,1,1},{1,1,2},{2,1,1},{3,3,0},{4,3,0},{5,1,5}}},
    { 9,1,16,1,0, {{0,1,1},{1,1,1},{2,0,2},{3,0,1},{4,3,0},{5,1,6},{6,3,0},{7,1,3},{8,0,5},{9,1,3},{10,3,0},{11,3,0},{12,1,5},{13,0,6},{14,0,1},{15,0,1}}},
    { 12,1,49,1,0, {{0,0,1},{1,0,5},{2,0,3},{3,1,3},{4,1,1},{5,0,1},{6,0,5},{7,0,5},{8,0,3},{9,0,3},{10,0,5},{11,0,3},{12,0,3},{13,0,1},{14,0,3},{15,0,3},{16,0,3},{17,0,1},{18,0,1},{19,0,3},{20,0,3},{21,0,1},{22,0,1},{23,0,1},{24,0,1},{25,0,1},{26,0,1},{27,0,3},{28,0,1},{29,1,5},{30,0,5},{31,0,5},{32,0,1},{33,1,3},{34,1,3},{35,1,3},{36,1,3},{37,1,3},{38,1,3},{39,1,3},{40,1,3},{41,1,3},{42,1,3},{43,1,3},{44,1,3},{45,1,3},{46,1,3},{47,1,3},{48,1,6}}},
    { 18,0,13,1,0, {{0,0,3},{1,0,5},{2,0,3},{3,0,5},{4,0,5},{5,0,5},{6,0,5},{7,0,5},{8,0,5},{9,0,5},{10,0,3},{11,0,5},{12,0,5}}},
#endif
    {19, 1, 6, 1, 0, {{0, 0, 2}, {1, 0, 3}, {2, 0, 3}, {3, 0, 1}, {4, 0, 1}, {5, 0, 3}}},
    {0},
    {0},
    {0},
    {0},
    {0},
    {0},
    {0},
    {0},
    {0},
    {0},
};

static int find_internal_object(uint16_t objid)
{
    int size = sizeof(internal_obj_table) / sizeof(internal_obj_table[0]);
    for (int i = 0; i < size; i++)
        if (internal_obj_table[i].objid == objid)
            return i;
    return -1;
}

ipso_obj_t *lwm2m_get_ipso_obj(uint16_t objId, int16_t resId, ipso_res_t **ipso_res, uint8_t ref)
{
    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;

    if (find_internal_object(objId) == -1 && lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
    }

    for (int i = 0; i < max_size; i++)
        if (type_array[i].objId == objId)
        {
            if ((int)resId != -1 && ipso_res != NULL)
            {
                for (int j = 0; j < type_array[i].resCount; j++)
                    if (type_array[i].resArray[j].resId == resId)
                    {
                        *ipso_res = &(type_array[i].resArray[j]);
                        break;
                    }
            }
            return &(type_array[i]);
        }
    return NULL;
}

lwm2m_tpye_t lwm2m_get_ipso_res_type(uint16_t objId, uint16_t resId)
{
    int size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;

    for (int i = 0; i < size; i++)
    {
        if (type_array[i].objId == objId)
        {
            for (int j = 0; j < type_array[i].resCount; j++)
            {
                if (type_array[i].resArray[j].resId == resId)
                {
                    return type_array[i].resArray[j].value_type;
                }
            }
        }
    }
    return 0;
}

uint8_t lwm2m_isObjSupport(uint16_t objId, uint8_t ref)
{
    if (find_internal_object(objId) != -1)
        return true;

    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    if (lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
    }

    for (int i = 0; i < max_size; i++)
        if (type_array[i].objId == objId)
            return true;
    return false;
}

bool lwm2m_isResReady(uint16_t objId, uint8_t ref)
{
    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    if (lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
    }

    for (int i = 0; i < max_size; i++)
        if (type_array[i].objId == objId)
        {
            return type_array[i].isResReady;
        }
    return false;
}

bool lwm2m_isResDiscover(uint16_t objId, uint8_t ref)
{
    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    if (lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
    }

    for (int i = 0; i < max_size; i++)
    {
        if (type_array[i].objId == objId)
        {
            return type_array[i].isDiscover;
        }
    }
    return false;
}

void lwm2m_resetResDiscoverState(uint16_t objId, uint8_t ref)
{
    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    for (int i = 0; i < max_size; i++)
    {
        if (type_array[i].objId == objId)
        {
            type_array[i].isDiscover = false;
        }
    }
}

lwm2m_ret_t lwm2m_ipso_register(ipso_obj_t *ipso_obj, uint8_t ref)
{
    //if (!isRefValid(ref) || isRefRegistered(ref))
    //    return LWM2M_RET_ERROR;

    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    int index = IPSO_STDOBJ_SIZE;
    if (lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
        index = 0;
    }

    int newIndex = -1;
    for (int i = index; i < max_size; i++)
    {
        if (type_array[i].objId == ipso_obj->objId)
        {
            newIndex = i;
            break;
        }
        else if (type_array[i].objId == 0 && newIndex == -1)
            newIndex = i;
    }
    if (newIndex != -1 && newIndex < MAX_INIT_OBJECTS)
    {
        type_array[newIndex].objId = ipso_obj->objId;
        memcpy(&type_array[newIndex], ipso_obj, sizeof(ipso_obj_t));
        return LWM2M_RET_OK;
    }

    return LWM2M_RET_ERROR;
}

void lwm2m_registNewObj(uint16_t objId, uint16_t resCount, uint8_t ref)
{
    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    int index = IPSO_STDOBJ_SIZE;
    if (lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
        index = 0;
    }

    for (int i = index; i < max_size; i++)
        if (type_array[i].objId == 0)
        {
            type_array[i].objId = objId;
            type_array[i].resCount = resCount;
            break;
        }
}

int lwm2m_registNewRes(uint16_t objId, uint8_t *resString, uint8_t ref)
{
    int max_size = sizeof(ipso_stdobj_table) / sizeof(ipso_stdobj_table[0]);
    ipso_obj_t *type_array = ipso_stdobj_table;
    int index = 0;

    if (lwm2m_is_dynamic_ipso(ref))
    {
        type_array = lwm2m_configs[ref]->obj_type_table;
        max_size = MAX_DYNAMIC_OBJECTS;
    }

    for (int i = index; i < max_size; i++)
    {
        if (type_array[i].objId == objId)
        {
            bool isNewRes = false;
            if (!type_array[i].isResReady)
            {
                isNewRes = true;
            }

            int *value = lwm2m_malloc(type_array[i].resCount * 4);
            lwm2m_parse_buffer((char *)resString, value, type_array[i].resCount, ";");
            for (int j = 0; j < type_array[i].resCount; j++)
            {
                if ((const char *)value[j] == NULL)
                {
                    lwm2m_free(value);
                    return COAP_404_NOT_FOUND;
                }

                uint16_t resId = (uint16_t)atoi((const char *)value[j]);
                if (isNewRes)
                {
                    type_array[i].resArray[j].resId = resId;
                    if (!lwm2m_is_dynamic_ipso(ref))
                    {
                        type_array[i].resArray[j].value_type = lwm2m_get_ipso_res_type(objId, resId);
                    }
                }
                else
                {
                    bool isHasRes = false;
                    for (int temIndex = 0; temIndex < type_array[i].resCount; temIndex++)
                    {
                        if (type_array[i].resArray[temIndex].resId != resId)
                        {
                            continue;
                        }
                        else
                        {
                            isHasRes = true;
                            break;
                        }
                    }

                    if (!isHasRes)
                    {
                        lwm2m_free(value);
                        return -1;
                    }
                }
            }
            type_array[i].isResReady = true;
            type_array[i].isDiscover = true;
            lwm2m_free(value);
            return 1;
        }
    }
    return 0;
}

static lwm2m_object_t *get_internal_object(lwm2m_context_t *contextP, uint16_t objid, uint16_t instid, uint8_t *isNewObj)
{
    lwm2m_object_t *targetP;
    int index = find_internal_object(objid);
    if (index < 0)
        return NULL;

    targetP = (lwm2m_object_t *)LWM2M_LIST_FIND(contextP->objectList, objid);
    if (targetP == NULL)
    {
        targetP = internal_obj_table[index].func(contextP);
        if (targetP == NULL)
            return NULL;
        *isNewObj = true;
    }
    return targetP;
}

static lwm2m_object_t *add_object(lwm2m_context_t *contextP, uint16_t objid, uint16_t instid)
{
    lwm2m_object_t *targetP;
    bool isNewObj = false;

    LOG_ARG("add_object: /%d/%d", objid, instid);
    targetP = get_internal_object(contextP, objid, instid, (uint8_t *)&isNewObj);
    if (targetP == NULL)
        targetP = get_skel_object(contextP, objid, instid, &isNewObj);
    if (targetP == NULL)
        return NULL;

    if (isNewObj)
        contextP->objectList = (lwm2m_object_t *)LWM2M_LIST_ADD(contextP->objectList, targetP);
    lwm2m_list_t *inst = LWM2M_LIST_FIND(targetP->instanceList, instid);
    if (inst == NULL && targetP->createFunc != NULL)
        targetP->createFunc(instid, 0, NULL, targetP);
    else
    {
        if (isNewObj)
        {
            LWM2M_LIST_RM(contextP->objectList, objid, &targetP);
            lwm2m_free(targetP);
        }
        return NULL;
    }
    if (contextP->state == STATE_READY)
    {
        lwm2m_update_registration(contextP, 0, true);
    }

    return targetP;
}

bool add_mult_objinsts(lwm2m_context_t *contextP, uint16_t objid, uint32_t instCount, uint8_t *bitmap)
{
    //uint8_t result=0;
    uint32_t count = strlen((char *)bitmap);
    LOG_ARG("add_mult_objinsts bitmap:%s, instCount:%d", bitmap, instCount);
    if (count > instCount)
        count = instCount;
    for (int8_t i = count - 1; i >= 0; i--)
    {
        //LOG_ARG("bitmap[%d]:%c", i,bitmap[i]);
        if (bitmap[i] == '1')
        {
            if (add_object(contextP, objid, count - i - 1) == NULL)
            {
                LOG_ARG("add_mult_objinsts error ID: %d, instId:%d", objid, count - i - 1);
                return false;
            }
        }
    }
    return true;
}

void clean_all_objects(lwm2m_context_t *context)
{
    while (NULL != context->objectList)
    {
        lwm2m_object_t *object;
        object = context->objectList;
        context->objectList = object->next;
        object->cleanFunc(object);
    }
}
